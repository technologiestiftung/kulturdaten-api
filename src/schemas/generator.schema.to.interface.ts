import { writeFileSync } from 'fs'
import { compileFromFile } from 'json-schema-to-typescript'

async function generate() {

	generateInterface('organizations/organization', 'organizations/models/organization');
	generateInterface('organizations/createOrganization', 'organizations/dtos/create.organization.dto');
	generateInterface('organizations/patchOrganization', 'organizations/dtos/patch.organization.dto');

	generateInterface('users/user', 'users/models/user');
	generateInterface('users/createUser', 'users/dtos/create.user.dto');
	generateInterface('users/patchUser', 'users/dtos/patch.user.dto');

	generateInterface('auth/auth', 'auth/dtos/auth');
	generateInterface('auth/login', 'auth/dtos/login');

	generateInterface('health/health', 'health/dtos/health');

	generateInterface('errors/notFoundError', 'common/errors/notFoundError');

	
}

async function generateInterface(schemaFile: string, targetFile: string) {
	
	const options = (baseFile: string) => {
		return {
			bannerComment: `/* eslint-disable */
		/**
		 * This file was automatically generated by json-schema-to-typescript.
		 * DO NOT MODIFY IT BY HAND. Instead, modify the source JSONSchema file.
		 * 
		 * =>  @see ${baseFile}
		 * 
		 * and run "npm run schema-to-interface" to regenerate this file.
		 */
		`,
		additionalProperties: false

		}
	};
	const schemaPath = `./src/schemas/${schemaFile}.json`;
	const targetPath = `./src/${targetFile}.generated.ts`;

	writeFileSync(targetPath, await compileFromFile(schemaPath, options(schemaPath)))	
}

generate();